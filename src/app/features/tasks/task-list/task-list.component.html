<div class="task-list-container">
  <header class="task-header">
    <h1>{{ pageTitle }}</h1>
    <!-- Using async pipe with taskCounts$ observable -->
    <p class="task-summary" *ngIf="taskCounts$ | async as counts">
      Total: <strong>{{ totalTasks$ | async }}</strong> tasks | 
      Todo: <strong>{{ counts.todo }}</strong> | 
      Doing: <strong>{{ counts.doing }}</strong> | 
      Done: <strong>{{ counts.done }}</strong>
    </p>
  </header>

  <!-- Search filter with two-way binding using [(ngModel)] -->
  <div class="search-section">
    <div class="search-box">
      <label for="search">Search Tasks:</label>
      <input 
        type="text" 
        id="search"
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange()"
        placeholder="Search by title or description..."
        class="search-input">
      <button 
        class="btn btn-secondary btn-sm" 
        (click)="clearSearch()"
        *ngIf="searchTerm">
        Clear
      </button>
    </div>
    <!-- Using async pipe with filteredTasks$ observable -->
    <p class="search-results" *ngIf="searchTerm && (filteredTasks$ | async) as filteredTasks">
      Found <strong>{{ filteredTasks.length }}</strong> task(s) matching "{{ searchTerm }}"
    </p>
  </div>

  <!-- Error message display -->
  <app-error-message 
    *ngIf="errorMessage"
    [message]="errorMessage"
    type="error"
    (dismissed)="errorMessage = ''">
  </app-error-message>

  <!-- Loading spinner using reusable component -->
  <app-loading-spinner 
    *ngIf="isLoading$ | async"
    message="Loading tasks..."
    size="medium">
  </app-loading-spinner>

  <!-- *ngIf directive: Show tasks section only if not loading -->
  <div class="tasks-section" *ngIf="!(isLoading$ | async)">
    <div class="section-header">
      <h2>Task List</h2>
      <a routerLink="/tasks/new" class="btn btn-primary">
        âž• Create New Task
      </a>
    </div>
    
    <!-- Using async pipe: Show empty state if no tasks -->
    <div class="empty-state" *ngIf="(tasks$ | async) as tasks; else loadingTasks">
      <p class="empty-message" *ngIf="!hasTasks(tasks)">
        No tasks found. Create your first task to get started!
      </p>
    </div>

    <!-- Using async pipe: Show no search results -->
    <ng-container *ngIf="searchTerm && (filteredTasks$ | async) as filteredTasks">
      <div class="empty-state" *ngIf="filteredTasks.length === 0">
        <p class="empty-message">No tasks match your search "{{ searchTerm }}"</p>
      </div>
    </ng-container>

    <!-- *ngFor directive: Loop through filtered tasks using async pipe -->
    <!-- Event binding: Listen to events from child component -->
    <ng-container *ngIf="searchTerm; else showAllTasks">
      <div class="tasks-grid" *ngIf="(filteredTasks$ | async) as filteredTasks">
        <app-task-item 
          *ngFor="let task of filteredTasks; let i = index" 
          [task]="task"
          [taskIndex]="i"
          (deleteTask)="onDeleteTask($event)"
          (editTask)="onEditTask($event)"
          (statusChange)="onStatusChange($event)">
        </app-task-item>
      </div>
    </ng-container>
    
    <ng-template #showAllTasks>
      <div class="tasks-grid" *ngIf="(tasks$ | async) as tasks">
        <app-task-item 
          *ngFor="let task of tasks; let i = index" 
          [task]="task"
          [taskIndex]="i"
          (deleteTask)="onDeleteTask($event)"
          (editTask)="onEditTask($event)"
          (statusChange)="onStatusChange($event)">
        </app-task-item>
      </div>
    </ng-template>
    
    <ng-template #loadingTasks>
      <div class="empty-state">
        <app-loading-spinner message="Loading tasks..." size="small"></app-loading-spinner>
      </div>
    </ng-template>
  </div>

  <!-- Confirm delete dialog -->
  <app-confirm-dialog
    [(visible)]="showDeleteDialog"
    title="Delete Task"
    message="Are you sure you want to delete this task? This action cannot be undone."
    confirmText="Delete"
    cancelText="Cancel"
    confirmType="danger"
    (confirm)="confirmDelete()"
    (cancel)="cancelDelete()">
  </app-confirm-dialog>
</div>
