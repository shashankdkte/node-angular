<div class="task-form-container">
  <div class="form-header">
    <h1>{{ isEditMode ? 'Edit Task' : 'Create New Task' }}</h1>
    <button class="btn btn-secondary" (click)="cancel()">Cancel</button>
  </div>

  <div class="form-content" *ngIf="!isLoading">
    <!-- Reactive Form with DevExtreme Components -->
    <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
      
      <!-- Title Field with Validation -->
      <div class="form-group">
        <label for="title">Title *</label>
        <dx-text-box
          formControlName="title"
          placeholder="Enter task title"
          [isValid]="!hasError('title', 'required') && !hasError('title', 'minlength')"
          [validationMessageMode]="'always'">
        </dx-text-box>
        <div class="error-message" *ngIf="hasError('title', 'required') || hasError('title', 'minlength')">
          {{ getErrorMessage('title') }}
        </div>
      </div>

      <!-- Description Field -->
      <div class="form-group">
        <label for="description">Description</label>
        <dx-text-area
          formControlName="description"
          placeholder="Enter task description"
          [height]="120"
          [maxLength]="500">
        </dx-text-area>
        <div class="error-message" *ngIf="hasError('description', 'maxlength')">
          {{ getErrorMessage('description') }}
        </div>
        <div class="char-count" *ngIf="f['description'].value">
          {{ f['description'].value.length }} / 500 characters
        </div>
      </div>

      <!-- Status Field -->
      <div class="form-group">
        <label for="status">Status *</label>
        <dx-select-box
          formControlName="status"
          [dataSource]="statusOptions"
          displayExpr="label"
          valueExpr="value"
          placeholder="Select status">
        </dx-select-box>
        <div class="error-message" *ngIf="hasError('status', 'required')">
          {{ getErrorMessage('status') }}
        </div>
      </div>

      <!-- Due Date Field -->
      <div class="form-group">
        <label for="dueDate">Due Date</label>
        <dx-date-box
          formControlName="dueDate"
          type="date"
          placeholder="Select due date"
          [showClearButton]="true">
        </dx-date-box>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <dx-button
          type="default"
          text="{{ isEditMode ? 'Update Task' : 'Create Task' }}"
          [disabled]="taskForm.invalid || isSubmitting"
          (onClick)="onSubmit()">
        </dx-button>
        <button type="button" class="btn btn-secondary" (click)="cancel()">
          Cancel
        </button>
      </div>

      <!-- Form Status -->
      <div class="form-status" *ngIf="taskForm.invalid && (taskForm.dirty || taskForm.touched)">
        <p class="error-text">Please fix the errors above before submitting.</p>
      </div>
    </form>
  </div>

  <div class="loading" *ngIf="isLoading">
    <p>Loading...</p>
  </div>
</div>
